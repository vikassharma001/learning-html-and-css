"use strict";(self.webpackChunkABCD_PDF=self.webpackChunkABCD_PDF||[]).push([[9786],{3434:(t,e,i)=>{i.d(e,{Z:()=>o});class s{constructor(t={}){this.options={selector:null,onDown:(t,e)=>{},onMove:(t,e)=>{},onUp:(t,e,i)=>{},onMergeEnter:(t,e,i)=>{},onMergeOut:(t,e,i)=>{},onMerge:(t,e,i)=>{},grid:null,snap:!1,stayTime:1e3,mergeAllow:!0,inElement:null,inElementPadding:0,isCancelDefaultEvent:!0,zIndex:999},this.options=Object.assign(this.options,t),this.offsetX=0,this.offsetY=0,this.clientX=0,this.clientY=0,this.currentClientX=0,this.currentClientY=0,this.timeout=null,this.dragging=!1,this.merging=!1,this.inElement=this.options.inElement,this.supportTouchEvent()?this.eventTypes={down:"touchstart",up:"touchend",move:"touchmove"}:this.eventTypes={down:"mousedown",up:"mouseup",move:"mousemove"},this.activeElement=null,this.targetElement=null,this.options.selector?this.initEvents():this.elements=[],this._downEvent=t=>this.downEvent(t)}initEvents(){this.elements=[],this.options.selector instanceof Node?this.elements.push(this.options.selector):this.options.selector instanceof NodeList?this.elements=this.options.selector:this.elements=document.querySelectorAll(this.options.selector),this.nodeListToArray(),this.elements.forEach((t=>{t.addEventListener(this.eventTypes.down,(t=>this.downEvent(t)))}))}nodeListToArray(){const t=[];this.elements instanceof NodeList&&(this.elements.forEach((e=>{t.push(e)})),this.elements=t)}addElement(t,e){e&&(e.position&&(t.style.position=e.position),null!==e.x&&(t.style.left=e.x),null!==e.y&&(t.style.top=e.y)),t.addEventListener(this.eventTypes.down,this._downEvent),this.elements.push(t)}addEvents(t){t.addEventListener(this.eventTypes.down,this._downEvent)}removeEvents(t){t.removeEventListener(this.eventTypes.down,this._downEvent)}downEvent(t){if(1!=t.which)return;const e=t.currentTarget;let i=e.getAttribute("data-target");this.activeElement=i?document.getElementById(i):e,this.setPositionAll(),this.dragging=!0,"mousedown"==t.type&&this.options.isCancelDefaultEvent&&this.cancelDefaultEvent(t);const s=this.activeElement.getBoundingClientRect();let n=t.touches?t.touches[0]:t;this.clientX=n.clientX,this.clientY=n.clientY,this.offsetX=s.left,this.offsetY=s.top;let o=this;this.activeElement.style.position="fixed",this.activeElement.style.zIndex=this.options.zIndex,this.activeElement.style.margin="0",this.activeElement.style.left=s.left+"px",this.activeElement.style.top=s.top+"px";let h=function(t){return o.moveEvent(t)};document.addEventListener(this.eventTypes.move,h);let a=function(t){return document.removeEventListener(o.eventTypes.move,h),document.removeEventListener(o.eventTypes.up,a),o.upEvent(t)};document.addEventListener(this.eventTypes.up,a),this.options.onDown(this.activeElement,t)}_isMerge(t,e,i){const s=t.getBoundingClientRect();return e>s.left&&e<s.right&&i>s.top&&i<s.bottom}setPositionAll(){this.elements.forEach(((t,e)=>{t.sort=e}))}moveEvent(t){let e=t.touches?t.touches[0]:t,i=e.clientX-this.clientX,s=e.clientY-this.clientY;if(i+=this.offsetX,s+=this.offsetY,this.inElement){const t=this.inElement.getBoundingClientRect(),e=this.activeElement.getBoundingClientRect();let n=t.left+this.options.inElementPadding,o=t.right-e.width-this.options.inElementPadding;i<n&&(i=n),i>o&&(i=o);let h=t.top+this.options.inElementPadding,a=t.bottom-e.height-this.options.inElementPadding;s<h&&(s=h),s>a&&(s=a)}if(!this.options.snap&&this.options.grid){let t=void 0!==this.options.grid.x,n=void 0!==this.options.grid.y;t&&this.options.grid.x>0&&(i=this.options.grid.x*Math.round((this.offsetX+(e.clientX-this.clientX))/this.options.grid.x)),n&&this.options.grid.y>0&&(s=this.options.grid.x*Math.round((this.offsetY+(e.clientY-this.clientY))/this.options.grid.x))}if(this.activeElement.style.top=s+"px",this.activeElement.style.left=i+"px",this.options.mergeAllow&&this.dragging){this.currentClientX=e.clientX,this.currentClientY=e.clientY;let i=!1;for(let e=0;e<this.elements.length;e++){const s=this.elements[e];if(this.activeElement!=s){if(this._isMerge(s,this.currentClientX,this.currentClientY)){if(i=!0,this.targetElement==this.activeElement||this.targetElement==s)break;this.targetElement=s,this.timeout||(this.timeout=setTimeout((()=>{clearTimeout(this.timeout),this.timeout=null,this.dragging&&this.targetElement&&this._isMerge(this.targetElement,this.currentClientX,this.currentClientY)&&(this.merging=!0,this.options.onMergeEnter(this.activeElement,this.targetElement,t))}),this.options.stayTime));break}this.targetElement=null,i=!1}}i||(this.targetElement=null,this.merging&&(this.merging=!1,this.options.onMergeOut(this.activeElement,this.targetElement,t)))}this.options.onMove(this.activeElement,t)}upEvent(t){let e=t.changedTouches?t.changedTouches[0]:t;if(this.dragging=!1,"mouseup"==t.type&&this.options.isCancelDefaultEvent&&this.cancelDefaultEvent(t),this.options.snap&&this.options.grid){let t=this.activeElement.offsetLeft-this.activeElement.offsetLeft%this.options.grid.x,e=this.activeElement.offsetTop-this.activeElement.offsetTop%this.options.grid.y;this.activeElement.style.left=t+"px",this.activeElement.style.top=e+"px"}if(this.options.mergeAllow&&this.merging&&(this.merging=!1,this.options.onMerge(this.activeElement,this.targetElement,e)),this.activeElement.style.position="absolute",this.inElement){const t=this.inElement.getBoundingClientRect();let e=parseInt(this.activeElement.style.left)-t.left,i=parseInt(this.activeElement.style.top)-t.top;"static"!=getComputedStyle(this.inElement).getPropertyValue("position")?(e-=this.inElement.clientLeft,i-=this.inElement.clientTop,this.activeElement.style.left=e+"px",this.activeElement.style.top=i+"px"):this.isStaticPosition(this.inElement)||(this.activeElement.style.left=e+"px",this.activeElement.style.top=i+"px")}this.options.onUp(this.activeElement,t,this),this.activeElement=null,this.targetElement=null}isStaticPosition(t){return!t.offsetParent||"static"==getComputedStyle(t.offsetParent).getPropertyValue("position")&&this.isStaticPosition(t.offsetParent)}supportTouchEvent(){let t=!0;try{document.createEvent("TouchEvent")}catch(e){t=!1}return t}cancelDefaultEvent(t){t.preventDefault(),t.stopPropagation()}}class n{constructor(t={}){this.options={selector:null,minWidth:100,minHeight:100,inElement:null,inElementPadding:0,showBorder:!1,elementClass:"__resizable",borderClass:"__resizable-border",position:["n","e","s","w","ne","se","sw","nw"],onDown:(t,e)=>{},onMove:(t,e)=>{},onUp:(t,e)=>{},setPosition:!1},this.options=Object.assign(this.options,t),this.options.showBorder&&(this.options.position=this.options.position.concat(["wr","er","nr","sr","ner","ser","swr","nwr"])),this.supportTouchEvent()?this.eventTypes={down:"touchstart",up:"touchend",move:"touchmove"}:this.eventTypes={down:"mousedown",up:"mouseup",move:"mousemove"},this.inElement=this.options.inElement,this.position=null,this.activeElement=null,this.options.selector?this.initEvents():this.elements=[]}initEvents(){this.elements=[],this.options.selector instanceof Node?this.elements.push(this.options.selector):this.options.selector instanceof NodeList?this.elements=this.options.selector:this.elements=document.querySelectorAll(this.options.selector),this.nodeListToArray(),this.elements.forEach((t=>{t.classList.add(this.options.elementClass),this.options.showBorder&&t.classList.add(this.options.borderClass),this.options.setPosition&&(t.style.position="absolute"),this.options.position.forEach((e=>{const i=document.createElement("div");i.className="resizable-handle resizable-"+e,t.append(i),i.addEventListener(this.eventTypes.down,(i=>(this.activeElement=t,this.position=e,this.downEvent(i))))}))}))}nodeListToArray(){const t=[];this.elements instanceof NodeList&&(this.elements.forEach((e=>{t.push(e)})),this.elements=t)}addElement(t){t.classList.add(this.options.elementClass),this.options.showBorder&&t.classList.add(this.options.borderClass),this.options.position.forEach((e=>{const i=document.createElement("div");i.className="resizable-handle resizable-"+e,t.append(i),i.addEventListener(this.eventTypes.down,(i=>(this.activeElement=t,this.position=e,this.downEvent(i))))})),this.elements.push(t)}downEvent(t){if(1!=t.which)return;if("mousedown"==t.type&&this.cancelDefaultEvent(t),"fixed"!=getComputedStyle(this.activeElement).getPropertyValue("position")){const t=this.activeElement.getBoundingClientRect();this.activeElement.style.position="fixed",this.activeElement.style.left=t.left+"px",this.activeElement.style.top=t.top+"px"}let e=t.touches?t.touches[0]:t;this.clientX=e.clientX,this.clientY=e.clientY,this.offsetX=this.activeElement.offsetLeft,this.offsetY=this.activeElement.offsetTop,this.offsetW=this.activeElement.offsetWidth,this.offsetH=this.activeElement.offsetHeight;let i=this,s=function(t){return i.moveEvent(t)};document.addEventListener(this.eventTypes.move,s);let n=function(t){return i.position=null,document.removeEventListener(i.eventTypes.move,s),document.removeEventListener(i.eventTypes.up,n),i.upEvent(t)};document.addEventListener(this.eventTypes.up,n),this.options.onDown(this.activeElement,t)}moveEvent(t){let e=t.touches?t.touches[0]:t,i=null,s=null;const n=this.activeElement.getBoundingClientRect();let o=n.width,h=n.height,a=null;switch(this.inElement&&(a=this.inElement.getBoundingClientRect()),this.position){case"n":case"nr":if(a&&e.clientY<=a.top+this.options.inElementPadding)return;if(this.offsetY<e.clientY&&h<this.options.minHeight)return;s=this.offsetY-e.clientY,this.activeElement.style.top=e.clientY+"px",this.activeElement.style.height=this.offsetH+s+"px";break;case"e":case"er":if(a&&e.clientX>=a.right-this.options.inElementPadding)return;if(this.offsetX+this.offsetW>e.clientX&&o<this.options.minWidth)return;i=e.clientX-this.offsetX-this.offsetW,this.activeElement.style.width=this.offsetW+i+"px";break;case"s":case"sr":if(a&&e.clientY>=a.bottom-this.options.inElementPadding)return;if(this.offsetY+this.offsetH>e.clientY&&h<this.options.minHeight)return;s=e.clientY-this.offsetY-this.offsetH,this.activeElement.style.height=this.offsetH+s+"px";break;case"w":case"wr":if(a&&e.clientX<=a.left+this.options.inElementPadding)return;if(this.offsetX<e.clientX&&o<this.options.minWidth)return;i=this.offsetX-e.clientX,this.activeElement.style.left=e.clientX+"px",this.activeElement.style.width=this.offsetW+i+"px";break;case"ne":case"ner":s=this.offsetY-e.clientY,i=e.clientX-this.offsetX-this.offsetW,a&&e.clientY<=a.top+this.options.inElementPadding||this.offsetY<e.clientY&&h<this.options.minHeight||(this.activeElement.style.top=e.clientY+"px",this.activeElement.style.height=this.offsetH+s+"px"),a&&e.clientX>=a.right-this.options.inElementPadding||this.offsetX+this.offsetW>e.clientX&&o<this.options.minWidth||(this.activeElement.style.width=this.offsetW+i+"px");break;case"se":case"ser":s=e.clientY-this.offsetY-this.offsetH,i=e.clientX-this.offsetX-this.offsetW,a&&e.clientY>=a.bottom-this.options.inElementPadding||this.offsetY+this.offsetH>e.clientY&&h<this.options.minHeight||(this.activeElement.style.height=this.offsetH+s+"px"),a&&e.clientX>=a.right-this.options.inElementPadding||this.offsetX+this.offsetW>e.clientX&&o<this.options.minWidth||(this.activeElement.style.width=this.offsetW+i+"px");break;case"sw":case"swr":s=e.clientY-this.offsetY-this.offsetH,i=this.offsetX-e.clientX,a&&e.clientY>=a.bottom-this.options.inElementPadding||this.offsetY+this.offsetH>e.clientY&&h<this.options.minHeight||(this.activeElement.style.height=this.offsetH+s+"px"),a&&e.clientX<=a.left+this.options.inElementPadding||this.offsetX<e.clientX&&o<this.options.minWidth||(this.activeElement.style.left=e.clientX+"px",this.activeElement.style.width=this.offsetW+i+"px");break;case"nw":case"nwr":s=this.offsetY-e.clientY,i=this.offsetX-e.clientX,a&&e.clientY<=a.top+this.options.inElementPadding||this.offsetY<e.clientY&&h<this.options.minHeight||(this.activeElement.style.top=e.clientY+"px",this.activeElement.style.height=this.offsetH+s+"px"),a&&e.clientX<=a.left+this.options.inElementPadding||this.offsetX<e.clientX&&o<this.options.minWidth||(this.activeElement.style.left=e.clientX+"px",this.activeElement.style.width=this.offsetW+i+"px")}this.options.onMove(this.activeElement,t)}upEvent(t){if("mouseup"==t.type&&this.cancelDefaultEvent(t),this.activeElement.style.position="absolute",this.inElement){const t=this.inElement.getBoundingClientRect();let e=parseInt(this.activeElement.style.left)-t.left,i=parseInt(this.activeElement.style.top)-t.top;"static"!=getComputedStyle(this.inElement).getPropertyValue("position")?(e-=this.inElement.clientLeft,i-=this.inElement.clientTop,this.activeElement.style.left=e+"px",this.activeElement.style.top=i+"px"):this.isStaticPosition(this.inElement)||(this.activeElement.style.left=e+"px",this.activeElement.style.top=i+"px")}this.options.onUp(this.activeElement,t),this.activeElement=null}isStaticPosition(t){return!t.offsetParent||"static"==getComputedStyle(t.offsetParent).getPropertyValue("position")&&this.isStaticPosition(t.offsetParent)}supportTouchEvent(){let t=!0;try{document.createEvent("TouchEvent")}catch(e){t=!1}return t}cancelDefaultEvent(t){t.preventDefault(),t.stopPropagation()}}const o=class{constructor(t={}){this.options={selector:"",resizable:!1,resizableOptions:{},draggable:!0,draggableOptions:{}},this.options=Object.assign(this.options,t),this.plugins={draggable:null,resizable:null},this.elements=null,this.options.selector&&(this.elements=document.querySelectorAll(this.options.selector)),this.init()}init(){this.options.draggable&&this.setDraggable(this.elements),this.options.resizable&&this.setResizable(this.elements)}addElement(t,e){this.elements||(this.elements=[]),this.elements.push(t),this.options.draggable&&this.plugins.draggable.addElement(t,e),this.options.resizable&&this.plugins.resizable.addElement(t)}setDraggable(t){this.options.draggableOptions.selector=t,this.plugins.draggable=new s(this.options.draggableOptions)}setResizable(t){this.options.resizableOptions.selector=t,this.plugins.resizable=new n(this.options.resizableOptions)}}},4423:(t,e,i)=>{i.d(e,{e:()=>m});var s=i(5335),n=i(749);var o=i(3434),h=i(6574);class a extends class{constructor(){this.bindEvents={}}on(t,e){t instanceof Array?t.forEach((t=>{this.__bindEvent(t,e)})):this.__bindEvent(t,e)}__bindEvent(t,e){this.bindEvents[t]||(this.bindEvents[t]=[]),this.bindEvents[t].push(e)}dispatchEvent(t,e){this.bindEvents[t]&&this.bindEvents[t].forEach((i=>{i({type:t,result:e})})),n.a.dispatchEvent(t,e)}}{constructor(t,e,i){super(),this.page=t,this.options={pos:{position:"absolute",x:0,y:0},drawOffset:{y:0,x:0},resizable:!0,resizableOptions:{showBorder:!0,minWidth:null,minHeight:null},draggable:!0,draggableOptions:{isCancelDefaultEvent:!0},setActions:t=>{}},i&&(this.options=Object.assign(this.options,i)),this.options.pos.position||(this.options.pos.position="absolute"),this.scale=t.scale,this.dragElement=null,this.drawOffset=this.options.drawOffset,this.attrs=e||{},this.dataType="",this.id=h.g.createId(),this.el=null,this.elChild=null,this.elClass="__pdf_editor_element",this.childClass="__pdf_editor_element_child",this.elActions=null,this.actualRect=null,this.initElement(),this.init()}get pdfEditor(){return this.page.pdfEditor}get pdfLibDocument(){return this.pdfEditor.pdfLibDocument}get pdfPage(){return this.page.pdfPage}get pdfPageProxy(){return this.page.pdfPageProxy}get pageScale(){return this.scale*this.page.outputScale}degrees(t){return this.pdfEditor.pdfLib.degrees(parseFloat(t))}init(){}setStyle(){}async insertToPDF(){}childElement(){return null}initElement(){this.el=document.createElement("div"),this.el.classList.add(this.elClass),this.el.style.cursor="pointer",this.el.style.zIndex=1,this.el.setAttribute("id",this.id),this.options.drawOffset.x&&(this.el.style.paddingLeft=this.options.drawOffset.x+"px",this.el.style.paddingRight=this.options.drawOffset.x+"px"),this.options.drawOffset.y&&(this.el.style.paddingTop=this.options.drawOffset.y+"px",this.el.style.paddingBottom=this.options.drawOffset.y+"px"),this.elActions=this.options.setActions(this),this.on(s.G.ELEMENT_RESIZE_END,(t=>{this.updateAttrSize()}))}updateAttrSize(){this.attrs.width=this.actualRect.width*this.scale,this.attrs.height=this.actualRect.height*this.scale}setActualRect(){this.actualRect={x:parseInt(this.el.style.left),y:parseInt(this.el.style.top),width:parseInt(this.el.style.width),height:parseInt(this.el.style.height)},this.actualRect.x/=this.scale,this.actualRect.y/=this.scale,this.actualRect.width/=this.scale,this.actualRect.height/=this.scale}zoom(t){this.scale=t;const e={x:this.actualRect.x*t,y:this.actualRect.y*t,width:this.actualRect.width*t,height:this.actualRect.height*t};return this.el.style.left=e.x+"px",this.el.style.top=e.y+"px",this.el.style.width=e.width+"px",this.el.style.height=e.height+"px",this.updateAttrSize(),this.dragElement.options.draggable&&(this.dragElement.plugins.draggable.inElement=this.page.content),this.dragElement.options.resizable&&(this.dragElement.plugins.resizable.inElement=this.page.content),e}edit(t){this.attrs=Object.assign(this.attrs,t),this.setStyle(t)}remove(){this.el.remove()}appendChild(t){t.classList.add(this.childClass),this.el.classList.add("__pdf_el_"+this.dataType),this.el.appendChild(t),this.dispatchEvent(s.G.ELEMENT_CREATE,this)}getY(){this.page.pdfPageProxy.view[2];let t=this.page.pdfPageProxy.view[3]/this.page.content.getBoundingClientRect().height;return(this.el.style.top?parseInt(this.el.style.top):0)*t+this.options.drawOffset.y/this.pageScale+1}getX(){let t=this.page.pdfPageProxy.view[2],e=(this.page.pdfPageProxy.view[3],t/this.page.content.getBoundingClientRect().width);return(this.el.style.left?parseInt(this.el.style.left):0)*e+this.options.drawOffset.x/this.pageScale+1}async render(){if(this.elChild=this.childElement(),!this.elChild)return;this.appendChild(this.elChild),this.el.classList.add("active"),this.el.setAttribute("data-type",this.dataType);const t=this.page.content;return null===this.options.pos.x&&(this.options.pos.x=t.offsetWidth/2.2+"px"),null===this.options.pos.y&&(this.options.pos.y=t.offsetHeight/2.2+"px"),"number"==typeof this.options.pos.x&&(this.options.pos.x=this.options.pos.x+"px"),"number"==typeof this.options.pos.y&&(this.options.pos.y=this.options.pos.y+"px"),this.options.resizableOptions.inElement=t,this.options.resizableOptions.onDown=(t,e,i)=>{this.dispatchEvent(s.G.ELEMENT_RESIZE_START,{el:t,evt:e,that:i}),e.stopPropagation()},this.options.resizableOptions.onMove=(t,e,i)=>{this.dispatchEvent(s.G.ELEMENT_RESIZING,{el:t,evt:e,that:i})},this.options.resizableOptions.onUp=(t,e,i)=>{this.setActualRect(),this.dispatchEvent(s.G.ELEMENT_RESIZE_END,{el:t,evt:e,that:i})},this.options.draggableOptions.inElement=t,this.options.draggableOptions.mergeAllow=!1,this.options.draggableOptions.onDown=(t,e,i)=>{t.classList.add("moving"),this.page.elements.setActive(this.id),this.dispatchEvent(s.G.ELEMENT_DOWN,{el:t,evt:e,that:i}),e.stopPropagation()},this.options.draggableOptions.onUp=(t,e,i)=>{t.classList.remove("moving"),this.setActualRect(),this.dispatchEvent(s.G.ELEMENT_UP,{el:t,evt:e,that:i})},this.options.draggableOptions.onMove=(t,e,i)=>{this.dispatchEvent(s.G.ELEMENT_MOVE,{el:t,evt:e,that:i})},this.dragElement=new o.Z({draggable:this.options.draggable,draggableOptions:this.options.draggableOptions,resizable:this.options.resizable,resizableOptions:this.options.resizableOptions}),this.dragElement.addElement(this.el,this.options.pos),this.page.wrapper.appendChild(this.el),this.setActualRect(),this.dispatchEvent(s.G.ELEMENT_RENDERD,this),this.el}}class l extends a{init(){this.dataType="image";this.attrs=Object.assign({width:null,height:null,image:null,opacity:1,arrayBuffer:null,rotate:null},this.attrs);let t=.35*this.pdfPageProxy.getViewport({scale:this.page.scale}).width;null===this.attrs.width&&(this.attrs.width=parseInt(this.attrs.image.width>t?t:this.attrs.image.width)),null===this.attrs.height&&(this.attrs.height=parseInt(this.attrs.image.width)!=this.attrs.width?parseInt(this.attrs.image.height*(this.attrs.width/this.attrs.image.width)):this.attrs.image.height),this.setStyle()}setStyle(){this.el.style.width=this.attrs.width+"px",this.el.style.height=this.attrs.height+"px",this.attrs.image.style.opacity=this.attrs.opacity}childElement(){return this.options.resizableOptions={showBorder:!0,minWidth:null,minHeight:null},this.attrs.image}async insertToPDF(){let t=this.getX(),e=this.getY(),i=this.attrs.width/this.pageScale,s=this.attrs.height/this.pageScale,n=await h.g.embedImage(this.pdfLibDocument,this.attrs.imageType,this.attrs.arrayBuffer);if(!n)return!1;let o={x:t,y:this.pdfPage.getHeight()-(e+s),width:i,height:s,opacity:this.attrs.opacity};return this.attrs.rotate&&(o.rotate=this.degrees(this.attrs.rotate)),this.pdfPage.drawImage(n,o),!0}}class r extends a{init(){this.dataType="rect";this.attrs=Object.assign({width:50,height:50,opacity:1,background:"#000000",rotate:-30.2},this.attrs),this.elRect=document.createElement("div"),this.elRect.style.width="100%",this.elRect.style.height="100%",this.setStyle()}setStyle(){this.el.style.width=this.attrs.width+"px",this.el.style.height=this.attrs.height+"px",this.elRect.style.background=this.attrs.background,this.elRect.style.opacity=this.attrs.opacity}childElement(){return this.setStyle(),this.options.resizableOptions={showBorder:!0,minWidth:null,minHeight:null},this.elRect}async insertToPDF(){let t=this.getX(),e=this.getY(),i=this.attrs.width/this.pageScale,s=this.attrs.height/this.pageScale,n={x:t,y:this.pdfPage.getHeight()-(e+s),width:i,height:s,color:this.pdfEditor.pdfLib.componentsToColor(h.g.hexToRgb(this.attrs.background).map((t=>t/255))),opacity:this.attrs.opacity};return this.attrs.rotate&&(n.rotate=this.degrees(this.attrs.rotate)),this.pdfPage.drawRectangle(n),!0}}class c extends a{init(){this.dataType="text";this.attrs=Object.assign({size:20,color:"#000000",text:"",lineHeight:null,font:null,opacity:1,underline:null,background:null,bold:!1,italic:!1,rotate:null},this.attrs),this.options.draggableOptions.isCancelDefaultEvent=!1,this.attrs.lineHeight||(this.attrs.lineHeight=this.attrs.size),this.options.resizable=!1,this.el.addEventListener("input",(t=>{this.attrs.text=this.elChild.innerText})),this.el.classList.add("__resizable","__resizable-border"),this.el.addEventListener("paste",(t=>{let e=t.clipboardData.getData("text/html")||t.clipboardData.getData("text/plain");e=e.replace(/<(?!(\/\s*)?(a|b|i|em|s|strong|u)[>,\s])([^>])*>/g,""),document.execCommand("insertHTML",!1,e),t.preventDefault()})),this.elText=document.createElement("div")}setStyle(t){t&&!t.lineHeight&&(this.attrs.lineHeight=this.attrs.size),this.elText.textContent=this.attrs.text,this.elText.style.color=this.attrs.color,this.elText.style.fontSize=this.attrs.size+"px",this.elText.style.fontWeight=this.attrs.bold?"bold":"",this.elText.style.fontStyle=this.attrs.italic?"italic":"",this.elText.style.textDecoration=this.attrs.underline?"underline":"",this.elText.style.background=this.attrs.background}zoom(t){super.zoom(t),this.elText.style.fontSize=this.attrs.size*t+"px"}childElement(){return this.clicked=0,this.setStyle(),this.elText.setAttribute("contenteditable",!0),this.elText.setAttribute("draggable",!1),this.elText.addEventListener("dragstart",(t=>(t.preventDefault(),t.stopPropagation(),!1))),this.elText.addEventListener("blur",(t=>{this.page.elements.activeId=null,this.el.classList.contains("active")&&(this.elText.style.cursor="pointer",this.el.classList.remove("active"),this.dispatchEvent(s.G.ELEMENT_BLUR,this))})),this.options.resizable=!1,setTimeout((()=>{this.elText.style.cursor="auto",this.elText.focus();let t=window.getSelection(),e=document.createRange();e.selectNodeContents(this.elText),t.removeAllRanges(),t.addRange(e)}),10),this.elText}}class p extends c{init(){super.init(),this.dataType="textCanvas"}async insertToPDF(){let t=(this.pageScale<2?2:this.pageScale)+this.scale,e=this.attrs.size*t,i=this.attrs.text.split(/[\n\f\r\u000B]/),s=this.attrs.underline?e/14:0,n=(this.attrs.lineHeight?this.attrs.lineHeight:e)+4;n*=t;let o=this.elChild.getBoundingClientRect(),h=document.createElement("canvas");n+=s;let a=o.width/this.scale*t+0,l=i.length*n+0;h.width=a-6,h.height=l;let r=h.getContext("2d");this.attrs.background&&(r.fillStyle=this.attrs.background,r.fillRect(0,0,h.width,h.height));let c=[];this.attrs.italic&&c.push("italic"),this.attrs.bold&&c.push("bold"),c.push(e+"px"),c.push(this.attrs.font),r.font=c.join(" "),r.fillStyle=this.attrs.color;for(let t=0;t<i.length;t++){let e=r.measureText(i[t]),o=n*(t+1)-s+(0-s);if(r.fillText(i[t],0,o-(this.attrs.underline?10:15),h.width),this.attrs.underline){let t=o,i=e.width;r.beginPath(),r.moveTo(0,t),r.lineWidth=s,r.lineTo(i+0,t),r.strokeStyle=r.fillStyle,r.stroke()}}let p=await this.pdfLibDocument.embedPng(h.toDataURL("image/png",1)),d=p.width/t,g=p.height/t,m={x:this.getX(),y:this.pdfPage.getHeight()-(this.getY()+g),width:d,height:g,opacity:this.attrs.opacity};return this.attrs.rotate&&(m.rotate=this.degrees(this.attrs.rotate)),this.pdfPage.drawImage(p,m),!0}}var d=i(4634);class g extends a{init(){this.dataType="drawRect";this.attrs=Object.assign({background:"#000000",opacity:1},this.attrs),this.el.style.width=this.attrs.width+"px",this.el.style.height=this.attrs.height+"px",this.drawHandle=null}childElement(){return this.drawHandle=new d.Z({container:this.page.elementLayer,scrollElement:this.page.pdfEditor.mainBox,background:this.attrs.background,opacity:this.attrs.opacity,onFinished:t=>{new r(this.page,{pos:{x:t.x,y:t.y}},{width:t.width,height:t.height,opacity:this.attrs.opacity,background:this.attrs.background}).render()}}),null}}class m{constructor(t){this.page=t,this.items={},this.activeId=null}setActive(t){if(this.activeId==t)return;if(this.activeId){const t=this.get(this.activeId);if(!t.el.classList.contains("active"))return void this.activeId;t.el.classList.remove("active"),n.a.dispatchEvent(s.G.ELEMENT_BLUR,t)}if(this.activeId=t,null===t)return;const e=this.get(t);e.el.classList.add("active"),n.a.dispatchEvent(s.G.ELEMENT_ACTIVE,e)}zoom(t){for(let e in this.items)this.items[e].zoom(t)}async insertToPDF(){for(let t in this.items)await this.items[t].insertToPDF();return!0}get length(){return Object.keys(this.items).length}add(t,e,i){let s=null;switch(t){case"text":s=new c(this.page,e,i);break;case"textCanvas":s=new p(this.page,e,i);break;case"rect":s=new r(this.page,e,i);break;case"image":s=new l(this.page,e,i);break;case"drawRect":s=new g(this.page,e,i)}if(s.render(),s.elChild)return this.items[s.id]=s,this.setActive(s.id),s}get(t){return this.items[t]}edit(t,e){return this.get(t).edit(e)}remove(t){this.get(t).remove(),delete this.items[t],this.activeId=null,n.a.dispatchEvent(s.G.ELEMENT_REMOVE,t)}}},5335:(t,e,i)=>{i.d(e,{G:()=>s});const s={PAGE_ZOOM:"page_zoom",PAGE_ACTIVE:"page_active",PAGE_RENDERED:"page_rendered",PAGE_DOWN:"page_down",ELEMENT_CREATE:"element_create",ELEMENT_ACTIVE:"element_active",ELEMENT_REMOVE:"element_remove",ELEMENT_BLUR:"element_blur",ELEMENT_UP:"element_up",ELEMENT_MOVE:"element_move",ELEMENT_DOWN:"element_down",ELEMENT_RENDERD:"element_rendered",ELEMENT_RESIZE_START:"element_resize_start",ELEMENT_RESIZING:"element_resizing",ELEMENT_RESIZE_END:"element_resize_end",TOOLBAR_ITEM_ACTIVE:"toolbar_item_active",TOOLBAR_ITEM_BLUR:"toolbar_item_blur"}},749:(t,e,i)=>{i.d(e,{a:()=>s});const s={bindEvents:{},addEventListener:(t,e)=>{t instanceof Array?t.forEach((t=>{s.__bindEvent(t,e)})):s.__bindEvent(t,e)},__bindEvent:(t,e)=>{s.bindEvents[t]||(s.bindEvents[t]=[]),s.bindEvents[t].push(e)},dispatchEvent:(t,e)=>{s.bindEvents[t]&&s.bindEvents[t].forEach((i=>{i({type:t,result:e})}))}}},8117:(t,e,i)=>{i.a(t,(async t=>{i.d(e,{T:()=>l});var s=i(1095),n=i(5335),o=i(749),h=i(4423),a=t([s]);s=(a.then?await a:a)[0];class l{constructor(t,e,i,s){this.pdfEditor=t,this.elements=new h.e(this),this.container=null,this.wrapper=null,this.elementLayer=null,this.content=null,this.contentClass="__pdf_item_render",this.renderType=s||"image",this.rendered=!1,this.pdfPageProxy=null,this._pdfPage=null,this.outputScale=window.devicePixelRatio||1,this.pageNum=parseInt(e),this.index=this.pageNum-1,this.scale=i,this.init()}get pdfDocumentProxy(){return this.pdfEditor.pdfDocumentProxy}get pdfLibDocument(){return this.pdfEditor.pdfLibDocument}get pdfPage(){return this._pdfPage?this._pdfPage:this.pdfEditor.pdfLibDocument.getPage(this.index)}init(){let t="__pdf_page_preview";this.container=document.createElement("div"),this.container.classList.add(t),this.container.setAttribute("data-page",this.pageNum),this.wrapper=document.createElement("div"),this.wrapper.classList.add(t+"_wrapper"),this.wrapper.style.position="relative",this.elementLayer=document.createElement("div"),this.elementLayer.style.position="absolute",this.elementLayer.style.left="0px",this.elementLayer.style.top="0px",this.elementLayer.style.zIndex=1,this.elementLayer.classList.add("elementLayer"),this.elementLayer.addEventListener("mousedown",(t=>{this.elements.setActive(null),o.a.dispatchEvent(n.G.PAGE_DOWN,{evt:t,page:this})})),this.wrapper.appendChild(this.elementLayer),this.container.appendChild(this.wrapper)}getElement(t){return this.elements.get(t)}zoom(t,e){this.scale=t,this.rendered=!1,this.render(e).then((()=>{this.elements.zoom(t)}))}async save(){return this.elements.length<1||this.elements.insertToPDF()}clearWrapper(){this.wrapper.querySelectorAll("canvas").forEach((t=>{t.remove()})),this.textLayer&&(this.textLayer.innerHTML="")}async render(t){if(this.rendered)return this.container;let e=this.renderType;switch(t&&!t.renderType&&(t.renderType=this.renderType),e){case"html":this.content=await this.renderHTML();break;case"image":this.content=await this.renderImage(t);break;case"canvas":this.content=await this.renderCanvas()}return this.rendered=!0,this.clearWrapper(),this.wrapper.appendChild(this.content),this.elementLayer.style.width=this.content.width+"px",this.elementLayer.style.height=this.content.height+"px",this.container.style.width=this.content.width+"px",this.container.style.height=this.content.height+"px",o.a.dispatchEvent(n.G.PAGE_RENDERED,this),this.container}async renderHTML(){i.e(8539).then(i.bind(i,8539));let t=await this.renderCanvas();this.textLayer||(this.textLayer=document.createElement("div"),this.textLayer.classList.add("textLayer"),this.wrapper.appendChild(this.textLayer)),this.textLayer.style.width=t.width+"px",this.textLayer.style.height=t.height+"px";let e=this.pdfPageProxy.getViewport({scale:this.scale});this.pdfPageProxy.getTextContent().then((t=>{const i=this.pdfPageProxy.streamTextContent({normalizeWhitespace:!0,includeMarkedContent:!0});s.renderTextLayer({textContent:t,textContentStream:i,container:this.textLayer,viewport:e,textDivs:[],textContentItemsStr:[],enhanceTextSelection:!0})})),this.annotationLayer||(this.annotationLayer=document.createElement("div"),this.annotationLayer.classList.add("annotationLayer"),this.wrapper.appendChild(this.annotationLayer));let n={annotations:this.annotations,viewport:e.clone({dontFlip:!0}),div:this.annotationLayer,page:this.pdfPageProxy};return this.annotations?s.AnnotationLayer.update(n):this.pdfPageProxy.getAnnotations().then((t=>{this.annotations=t,n.annotations=t,s.AnnotationLayer.render(n)})),t}async renderImage(t){let e=await this.renderCanvas(),i=new Image;return i.src=e.toDataURL(),i.style.width=t.width,i.style.height=t.height,i.classList.add(this.contentClass),i}async renderCanvas(){this.pdfPageProxy||(this.pdfPageProxy=await this.pdfDocumentProxy.getPage(this.pageNum));let t=this.pdfPageProxy.getViewport({scale:this.scale}),e=document.createElement("canvas");e.classList.add(this.contentClass),e.width=Math.floor(t.width*this.outputScale),e.height=Math.floor(t.height*this.outputScale);let i={canvasContext:e.getContext("2d"),transform:1!==this.outputScale?[this.outputScale,0,0,this.outputScale,0,0]:null,viewport:t};return await this.pdfPageProxy.render(i).promise,e}}}))},9786:(t,e,i)=>{i.a(t,(async t=>{i.d(e,{i:()=>l});var s=i(5335),n=i(749),o=i(8117),h=i(6574),a=t([o]);o=(a.then?await a:a)[0];class l{constructor(t,e){this.pdfEditor=t,this.scale=e,this.items=[],this.pageActive=0}get pdfDocumentProxy(){return this.pdfEditor.pdfDocumentProxy}get pdfLibDocument(){return this.pdfEditor.pdfLibDocument}setActive(t,e){if(this.pageActive!=t){if(this.pageActive=t,this.pdfEditor.mainBox.querySelector(".__pdf_page_preview.active")?.classList.remove("active"),this.get(t).container.classList.add("active"),this.pdfEditor.thumbsBox&&(this.pdfEditor.thumbsBox.querySelector(".__pdf_page_preview.active")?.classList.remove("active"),this.pdfEditor.thumbsBox.querySelector('.__pdf_page_preview[data-page="'+t+'"]')?.classList.add("active"),!e)){let e=this.pdfEditor.thumbsBox.querySelector('.__pdf_page_preview[data-page="'+t+'"]');h.g.scrollTo(e,this.pdfEditor.thumbsBox)}h.g.scrollTo(this.get(t).container,this.pdfEditor.mainBox),n.a.dispatchEvent(s.G.PAGE_ACTIVE,t)}}get(t){let e=parseInt(t)-1;if(this.items[e])return this.items[e];let i=new o.T(this.pdfEditor,t,this.scale);return this.items[e]=i,this.items[e]}getPageActive(){return this.get(this.pageActive)}get length(){return this.pdfDocumentProxy.numPages}remove(t){let e=parseInt(t)-1;this.items.splice(e,1),this.pdfLibDocument.removePage(e)}removePages(t){let e=1;t.map((t=>{try{let i=parseInt(t)-e;this.items.splice(i,1),this.pdfLibDocument.removePage(i),e++}catch(t){}}))}zoom(t,e){this.scale=t,clearTimeout(this.timeout),this.timeout=setTimeout((()=>{let i=Math.max(1,this.pageActive-5),s=Math.min(this.length,this.pageActive+5);for(let n=i;n<=s;n++)this.get(n).zoom(t,e)}),1)}async save(){for(let t in this.items)await this.get(parseInt(t)+1).save();return!0}to(t){this.setActive(t)}prev(){let t=Math.max(this.pageActive-1,1);return this.to(t)}next(){let t=Math.min(this.pageActive+1,this.length);return this.to(t)}}}))},6574:(t,e,i)=>{i.d(e,{g:()=>s});const s={normalizeWheelEventDirection(t){let e=Math.hypot(t.deltaX,t.deltaY);const i=Math.atan2(t.deltaY,t.deltaX);return-.25*Math.PI<i&&i<.75*Math.PI&&(e=-e),e},scrollTo:(t,e)=>{const i=e.getBoundingClientRect();let s=i.bottom,n=i.top;const o=t.getBoundingClientRect();let h=o.bottom,a=o.top;h>s&&(e.scrollTop+=h-s),a<n&&(e.scrollTop-=n-a)},createId:(t,e)=>{let i="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz".split(""),s=[],n=i.length,o=e||36;s[0]=t||"pi_";for(let t=1;t<o;t++)s[t]=i[0|Math.random()*n];return s.join("")},rgbToHex:(t,e,i)=>"#"+((1<<24)+(t<<16)+(e<<8)+i).toString(16).slice(1),hexToRgb:t=>{let e=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(t);if(e){return[parseInt(e[1],16),parseInt(e[2],16),parseInt(e[3],16)]}return null},mergeDeep:(t,e)=>{for(let i in e){let n=e[i];null!==n?"object"!=typeof n||Array.isArray(n)?t[i]=n:t[i]=s.mergeDeep(t[i],n):t[i]=n}return t},embedImage:async(t,e,i)=>{let s=null;try{s="image/png"==e?await t.embedPng(i):await t.embedJpg(i)}catch(n){e="image/png"==e?"image/jpeg":"image/png";try{s="image/png"==e?await t.embedPng(i):await t.embedJpg(i)}catch(t){return!1}}return s},measureText(t,e){const i=document.createElement("canvas").getContext("2d");i.font=e;const s=i.measureText(t);return{width:s.width,height:s.actualBoundingBoxAscent+s.actualBoundingBoxDescent,ascent:s.actualBoundingBoxAscent,descent:s.actualBoundingBoxDescent}},genTextImage(t){const e=s.measureText(t.text,t.font),i=t.thickness||0,n=document.createElement("canvas");n.width=e.width+5,n.height=e.height+2*i;const o=n.getContext("2d");return o.font=t.font,o.fillStyle=t.color,o.fillText(t.text,0,e.ascent),t.underline&&(o.beginPath(),o.moveTo(0,n.height-i),o.lineTo(n.width,n.height-i),o.lineWidth=i,o.strokeStyle=o.fillStyle,o.stroke()),n}}},7886:(t,e,i)=>{i.d(e,{Z:()=>s});const s=class{constructor(t){this.options={container:"",zIndex:1,onFinished:()=>{},scrollElement:null},t&&(this.options=Object.assign(this.options,t)),this.scrollElement=this.options.scrollElement,this.firstPos={},this.offset={left:0,top:0},this.rect={x:0,y:0,width:0,height:0},this.options.container instanceof Node?this.container=this.options.container:this.container=document.querySelector(this.options.container),this.disabled=!1,this.drawing=!1,this.initEventTypes(),this.initEvents()}initEvents(){this.container.addEventListener(this.eventTypes.down,(t=>{this.disabled||t.target!=this.container&&!t.target.classList.contains("__draw_canvas")||(this.offset=this.getOffset(this.container),this.drawing=!0,this.firstPos=this.getPos(t),this.onDown(t))})),this.container.addEventListener(this.eventTypes.move,(t=>{this.drawing&&!this.disabled&&this.onMove(t)})),this.container.addEventListener(this.eventTypes.up,(t=>{if(!this.drawing||this.disabled)return;this.drawing=!1,this.flushRect(t);let e=this.onUp(t);e||(e=[]),this.options.onFinished(...e)}))}enable(){this.disabled=!1}disable(){this.drawing=!1,this.disabled=!0}flushRect(t){if(!this.box)return this.rect;let e=this.box.getBoundingClientRect();return this.rect={x:parseInt(this.box.style.left),y:parseInt(this.box.style.top),width:e.width,height:e.height},this.rect}getOffset(t,e,i){return null==e&&(e=0),null==i&&(i=0),t.offsetParent?(e+=t.offsetLeft,i+=t.offsetTop,this.getOffset(t.offsetParent,e,i)):{left:e,top:i}}getPos(t){let e=0,i=0;return this.scrollElement&&(e=this.scrollElement.scrollLeft,i=this.scrollElement.scrollTop),{x:t.pageX-this.offset.left+e,y:t.pageY-this.offset.top+i}}initEventTypes(){if(window.PointerEvent)this.eventTypes={down:"pointerdown",up:"pointerup",move:"pointermove"};else try{document.createEvent("TouchEvent"),this.eventTypes={down:"touchstart",up:"touchend",move:"touchmove"}}catch(t){this.eventTypes={down:"mousedown",up:"mouseup",move:"mousemove"}}}}},4634:(t,e,i)=>{i.d(e,{Z:()=>o});var s=i(7886);class n extends s.Z{constructor(t){super(t),this.options=Object.assign({background:"transparent",border:"1px dashed #0168b5",keep:!1,opacity:1},this.options),this.background=this.options.background,this.border=this.options.border,this.opacity=this.options.opacity}onDown(t){this.options.keep||this.container.querySelectorAll(".__draw_rect").forEach((t=>t.remove())),this.box=document.createElement("div"),this.box.classList.add("__draw_rect"),this.box.style.position="absolute",this.box.style.left=this.firstPos.x+"px",this.box.style.top=this.firstPos.y+"px",this.box.style.background=this.background,this.box.style.border=this.border,this.box.style.opacity=this.opacity,this.container.appendChild(this.box)}onMove(t){let e=this.getPos(t),i=this.firstPos.x,s=this.firstPos.y,n=e.x-this.firstPos.x,o=e.y-this.firstPos.y;e.x<this.firstPos.x&&(n=this.firstPos.x-e.x,i=e.x),e.y<this.firstPos.y&&(o=this.firstPos.y-e.y,s=e.y),this.box.style.width=n+"px",this.box.style.height=o+"px",this.box.style.left=i+"px",this.box.style.top=s+"px"}onUp(t){let e=[this.rect];return this.options.keep?(e.push(this.box),e):(this.box.remove(),e)}}const o=n}}]);