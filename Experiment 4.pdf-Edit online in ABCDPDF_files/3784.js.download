"use strict";(self.webpackChunkABCD_PDF=self.webpackChunkABCD_PDF||[]).push([[3784],{3784:(t,e,i)=>{i.a(t,(async t=>{i.d(e,{default:()=>d});var a=i(1095),s=i(9786),o=i(6574),n=i(749),r=i(5335),h=t([s,a]);[s,a]=h.then?await h:h;a.GlobalWorkerOptions.workerSrc="/js/pdfjs/pdf.worker.js";const d=class{constructor(t){this.options={url:null,reader:{thumbs:{box:"",width:"120px",height:"auto"},main:{box:"",renderType:"canvas"}},toolbar:{box:"",items:["pages","mouse","text","image","eraser","radact","highlight","line","download"]},enablePassword:!0,password:null,scale:1,debug:!1},t&&(this.options=o.g.mergeDeep(this.options,t)),this.pdfDocumentProxy=null,this.pdfLib=null,this.pdfLibDocument=null,this.pages=null,this.toolbar=null,this.thumbsBox=null,this.mainBox=null}on(t,e){return n.a.addEventListener(t,e)}async load(t){return this.options.url=t,this.options.reader=null,this.options.toolbar=null,this.init()}async init(){let t={url:this.options.url};this.options.enablePassword&&null!==this.options.password&&(t.password=this.options.password);try{const e=a.getDocument(t);return this.options.enablePassword&&(e.onPassword=(t,e)=>{let i="";a.PasswordResponses.NEED_PASSWORD==e?i="This document is password protected. Please enter a password.":a.PasswordResponses.INCORRECT_PASSWORD==e&&(i="Invalid password. Please try again."),t(prompt(i))}),this.pdfDocumentProxy=await e.promise,this.pages=new s.i(this,this.options.scale),this.options.reader&&(this.initReader(),window.addEventListener("wheel",(t=>{if(t.ctrlKey||t.metaKey){t.preventDefault();const e=o.g.normalizeWheelEventDirection(t);this.options.scale+=25/e,this.options.scale<=.25?this.options.scale=.25:this.options.scale>=3&&(this.options.scale=3),this.pages.zoom(this.options.scale),n.a.dispatchEvent(r.G.PAGE_ZOOM,this.options.scale)}}),{passive:!1})),this.options.toolbar&&(this.initToolbar(),this.initPdfLibDocument()),!0}catch(t){return"PasswordException"==t.name&&alert("Password protected file"),console.log(t),!1}}async initPdfLib(){return this.pdfLib=await i.e(9055).then(i.bind(i,9055)),!0}async initPdfLibDocument(){this.pdfLib||await this.initPdfLib();const t=await this.pdfDocumentProxy.getData();return this.pdfLibDocument=await this.pdfLib.PDFDocument.load(t,{ignoreEncryption:!0}),!0}initReader(){this.options.reader.thumbs&&(this.options.reader.thumbs.box instanceof Node?this.thumbsBox=this.options.reader.thumbs.box:this.thumbsBox=document.querySelector(this.options.reader.thumbs.box)),this.options.reader.main&&(this.options.reader.main.box instanceof Node?this.mainBox=this.options.reader.main.box:this.mainBox=document.querySelector(this.options.reader.main.box)),this.initObservers();for(let t=1;t<=this.pages.length;t++){let e=this.pages.get(t);e.renderType=this.options.reader.main.renderType;let i=e.container.cloneNode(!0);i.addEventListener("click",(e=>{this.pages.setActive(t,!0)})),e.container.style.width="800px",e.container.style.height="600px",this.options.reader.main&&(this.mainBox.appendChild(e.container),this.mainObserver.observe(e.container)),i.style.width="120px",i.style.height="150px";let a=document.createElement("div");a.textContent=t,a.classList.add("__pdf_page_number"),i.appendChild(a),this.options.reader.thumbs&&(this.thumbsBox.appendChild(i),this.thumbObserver.observe(i))}}initToolbar(){Promise.all([i.e(6299),i.e(3773)]).then(i.bind(i,6906)).then((({Toolbar:t})=>{this.toolbar=new t(this,this.options.toolbar)}))}initObservers(){let t={root:this.thumbsBox,rootMargin:"0px",threshold:.2};this.thumbObserver=new IntersectionObserver((t=>{t.forEach((t=>{if(!(t.intersectionRatio<=0)&&t.isIntersecting&&!t.target.querySelector(".__pdf_item_render")){let e=t.target.getAttribute("data-page");this.pages.get(e).renderImage(this.options.reader.thumbs).then((e=>{t.target.style.width=this.options.reader.thumbs.width,t.target.style.height=this.options.reader.thumbs.height,t.target.firstChild.appendChild(e)}))}}))}),t);let e={root:this.mainBox,rootMargin:"0px",threshold:.5};this.mainObserver=new IntersectionObserver((t=>{t.forEach((t=>{if(!(t.intersectionRatio<=0)&&t.isIntersecting){let e=t.target.getAttribute("data-page"),i=this.pages.get(e);i.scale!=this.pages.scale&&(i.scale=this.pages.scale,i.rendered=!1),i.render(this.options.reader.main).then((t=>{this.pages.setActive(i.pageNum)}))}}))}),e)}async download(t,e){if(e)if(this.options.debug)window.open(URL.createObjectURL(e));else{i(3162).saveAs(e,t)}else this.getBlob().then((e=>{if(this.options.debug)window.open(URL.createObjectURL(e));else{i(3162).saveAs(e,t)}}));return!0}async getBlob(){await this.pages.save();const t=await this.pdfLibDocument.save(),e=new Blob([t],{type:"application/pdf"});return await this.initPdfLibDocument(),e}async split(t,e){this.pdfLibDocument||await this.initPdfLibDocument();e.sort((function(t,e){return t<e?-1:t>e?1:0}));let i=e.map((t=>t-1));const a=await this.pdfLib.PDFDocument.create();(await a.copyPages(this.pdfLibDocument,i)).forEach((t=>{a.addPage(t)}));const s=await a.save(),o=new Blob([s],{type:"application/pdf"});if(!t)return o;this.download(t,o)}async merge(t,e){this.pdfLib||await this.initPdfLib();let i=[];for(let t=0;t<e.length;t++)i[t]=new Promise((async i=>{let a=e[t];if(a instanceof ArrayBuffer)i(await this.pdfLib.PDFDocument.load(a));else if("string"==typeof a){let t=await fetch(a).then((t=>t.arrayBuffer()));i(await this.pdfLib.PDFDocument.load(t))}else if(a instanceof File){const t=new FileReader;t.readAsArrayBuffer(a),t.addEventListener("loadend",(async t=>{i(await this.pdfLib.PDFDocument.load(t.target.result))}))}}));const a=await Promise.all(i),s=await this.pdfLib.PDFDocument.create();for(let t in a){let e=a[t];(await s.copyPages(e,e.getPageIndices())).forEach((t=>{s.addPage(t)}))}const o=new Blob([await s.save()],{type:"application/pdf"});if(!t)return o;this.download(t,o)}async toImage(t){return await this.pages.get(t).renderCanvas().then((t=>t.toDataURL()))}async toImages(){let t=[];for(let e=1;e<=this.pages.length;e++)t.push(this.toImage(e));return Promise.all(t)}async imagesToPDF(t,e,i){this.pdfLib||await this.initPdfLib();let a=[];for(let t=0;t<e.length;t++)a[t]=new Promise((async i=>{let a=e[t];if(a.image instanceof ArrayBuffer)a.imageType="image/jpeg",a.arrayBuffer=a.image,i(a);else if("string"==typeof a.image){let t=await fetch(a.image).then((t=>t.blob()));a.imageType=t.type,a.arrayBuffer=await t.arrayBuffer(),i(a)}else if(a.image instanceof File){const t=new FileReader;t.readAsArrayBuffer(a.image),t.addEventListener("loadend",(async t=>{a.imageType=a.type,a.arrayBuffer=t.target.result,i(a)}))}}));const s=await Promise.all(a),n=await this.pdfLib.PDFDocument.create();for(let t in s){let e=s[t],a=n.addPage(i),r=await o.g.embedImage(n,e.imageType,e.arrayBuffer);if(!r)return!1;let h=a.getWidth(),d=e.width?e.width:parseInt(r.width>h?h:r),l=e.height?e.height:parseInt(r.width)!=d?parseInt(r.height*(d/r.width)):r.height,p=e.rotate?parseFloat(e.rotate):0,c=void 0!==e.x?e.x:a.getWidth()/2-d/2,g=void 0!==e.y?a.getHeight()-l-e.y:a.getHeight()/2-l/2,f=void 0!==e.opacity?e.opacity:1;a.drawImage(r,{x:c,y:g,width:d,height:l,rotate:this.pdfLib.degrees(p),opacity:f})}const r=new Blob([await n.save()],{type:"application/pdf"});if(!t)return r;this.download(t,r)}async removePages(t,e){this.pdfLibDocument||await this.initPdfLibDocument(),this.pages.removePages(e);const i=await this.getBlob();if(!t)return i;this.download(t,i)}async watermark(t,e,i,a){await this.load(e),this.pdfLibDocument||await this.initPdfLibDocument();let s={type:"image",pages:null};a&&(s=Object.assign(s,a));let n=s.pages||this.pdfLibDocument.getPageIndices();if("image"==s.type){let t=[];for(let e=0;e<i.length;e++)t[e]=new Promise((async t=>{let a=i[e];if(a.image instanceof ArrayBuffer)a.imageType="image/jpeg",a.arrayBuffer=a.image,t(a);else if("string"==typeof a.image){let e=await fetch(a.image).then((t=>t.blob()));a.imageType=e.type,a.arrayBuffer=await e.arrayBuffer(),t(a)}else if(a.image instanceof File){const e=new FileReader;e.readAsArrayBuffer(a.image),e.addEventListener("loadend",(async e=>{a.imageType=a.type,a.arrayBuffer=e.target.result,t(a)}))}}));const e=await Promise.all(t);for(let t=0;t<n.length;t++){let i=this.pdfLibDocument.getPage(t);for(let t in e){let a=e[t],s=await o.g.embedImage(this.pdfLibDocument,a.imageType,a.arrayBuffer);if(!s)return!1;let n=i.getWidth(),r=a.width?a.width:parseInt(s.width>n?n:s),h=a.height?a.height:parseInt(s.width)!=r?parseInt(s.height*(r/s.width)):s.height,d=a.rotate?parseFloat(a.rotate):0,l=void 0!==a.x?a.x:i.getWidth()/2-r/2,p=void 0!==a.y?i.getHeight()-h-a.y:i.getHeight()/2-h/2,c=void 0!==a.opacity?a.opacity:1;i.drawImage(s,{x:l,y:p,width:r,height:h,rotate:this.pdfLib.degrees(d),opacity:c})}}}else for(let t=0;t<n.length;t++){let e=this.pdfLibDocument.getPage(t);for(let t in i){let a=i[t],s=a.rotate?parseFloat(a.rotate):0,n=2,r=(a.size||20)*n,h=a.underline?r/14:0,d=[];a.italic&&d.push("italic"),a.bold&&d.push("bold"),d.push(r+"px"),d.push(a.font);let l=d.join(" ");const p=o.g.genTextImage({text:a.text,font:l,color:a.color,thickness:h,underline:a.underline});let c=a.x||0,g=e.getHeight()-r;a.y&&(g-=a.y);let f=void 0!==a.opacity?a.opacity:1,u=await this.pdfLibDocument.embedPng(p.toDataURL("image/png",1));e.drawImage(u,{x:c,y:g,width:p.width/2,height:p.height/2,rotate:this.pdfLib.degrees(s),opacity:f})}}const r=new Blob([await this.pdfLibDocument.save()],{type:"application/pdf"});if(!t)return r;this.download(t,r)}async pageNumbers(t,e,i){await this.load(e),this.pdfLibDocument||await this.initPdfLibDocument();const a=await this.pdfLibDocument.embedFont(this.pdfLib.StandardFonts.Helvetica);for(let t=0;t<this.pdfLibDocument.getPageCount();t++){this.pdfLibDocument.getPage(t).drawText((t+1).toString(),{x:i.x,y:i.y,font:a,size:i.size||20})}const s=new Blob([await this.pdfLibDocument.save()],{type:"application/pdf"});if(!t)return s;this.download(t,s)}}}))}}]);